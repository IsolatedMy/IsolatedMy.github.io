---
title: 量子线路作图工具qpic
comments: true
mathjax: true
layout: articles
toc: true
tags: ["quantum computing", "translation"]
---

这篇文章主要介绍了量子线路的画图工具`<q|pic>`的几个用例，并不涉及`<q|pic>`的设计细则。文章的内容翻译自github上的[qpic项目提供的文档](https://github.com/qpic/qpic/blob/master/doc/qpic_doc.pdf)。

<!--more-->

## 一、介绍

<div align=center><img src="{{ site.baseurl }}/assets/images/2021/qpic-1.png" style="zoom:30%" id="qpic-1"></div>

[Figure-1](#qpic-1)中展示了一个翻转$n$线上保存的信息且深度为$2n + 2$的线路，其中允许的操作是将一条线加到另一条相邻的线上。证明线路是正确的需要超过600词，但是主要思想通过图中红色标注的子线路传递。

这张图表示利用`<q|pic>`创建的。`<q|pic>`使用户可以以一种简单、人类可读的语言描述线路，一行可以声明一条*线*或称*导线(wire)*或声明一个逻辑操作，又称作*门(gate)*操作。一个Python脚本，我们将其称之为`qpic`，处理这些描述并利用TikZ画图包生成LaTeX代码。

保持语言简单就是`<q|pic>`设计原则的其中之一。用户可以从中抽出一些量子线路图共有的元素包括单线或者双线，其上面附有文字的矩形门，以及盒状的测量门。这些代码通过LaTeX进行翻译，所以任何数学表达式可以直接传递。目标并不是解决所有人想要的任何问题；相反的，命令被直接传递给LaTeX或者传递给TikZ，所以如果有需要，用户可以补充`<q|pic>`的输出(`qpic`会提供注释足够多的TikZ代码以简化这一过程)。

当然，在这个框架中`<q|pic>`也存在着其实现的局限性。创建TikZ代码的Python代码需要知道这些元素有多大，例如，为了使一个盒子足够大以包含某些文本，用户必须显式地声明宽度。因此可能需要多个循环以将图标正确的排队，而这在利用LaTeX是很正常的。

另一个设计原则为，对其他的可能，`<q|pic>`翻译器首先会从用户的输入创建线路的中间表示，然后从这一表示生成TikZ代码。这个例子就是VERTICAL命令；通过一行，用户可以将图中默认的时间流动方向（从左到右）改变成垂直流（从顶到底）。线路的内部表示在垂直和水平模式上都是相同的。实际上，表示和代码之间的界线并不总是像人们希望的那样清晰。

在这篇文章中，我们会给出一个`<q|pic>`简短但是完整的描述。

## 二、简单的例子

### 2.1 例一：多数

我们从一个简单到位的多数线路(majority circuit, 获得线路中存在较多的元素)，如[Figure-2](#qpic-2)所示。

<div align=center><img src="{{ site.baseurl }}/assets/images/2021/qpic-2.png" style="zoom:50%" id="qpic-2"></div>

`<q|pic>`代码的前三行使用了`W`指令，这用于声明一条导线。在`W`前面的字符串，是导线的名称，其是必要的并且被用于内部表示。关于导线名称的细则会在后面讨论——简而言之，导线的名称可以是不引起歧义的任何文本，但是由数字和小写字母组成的名称比较安全。这里，导线的名称分别为a, b和c。

如果一个`W`指令后面紧随着一个参数，它会被翻译成一个将会被在数学模式打印的标签并且在被放置在导线的最前面。（如果存在）第二个参数以相同的方式处理，但是它会被放在导线的最后。这里，每条导线都会具有一个开始以及结束标签，表示它的开始值以及结束值。

正常来说，`<q|pic>`语法分析器通过空白符分割每一行。但是，类似于`{a_\oplus_c}`(其中`_`代表一个空白符)这样的表达式就不会被分割。`<q|pic>`的目标语言为$\LaTeX$。所以尖括号(和美元符号)可以用来将一组带有空白符的文本表示为一个实体。

在一个空白行之后(被`<q|pic>`忽略)，第五行包含了我们的第一个门。包含门的这行代码的基本语义是一系列的目标，门(可能还带着一个所需的参数)，接着是一系列的控制(如果存在)。在这种情况中，门的类型为`G`，这意味着在目标周围会画一个矩形。在`G`后所需要的参数是门的名字，这会被放在矩形的中心。因为他会由TikZ处理，所以它可能包含画图命令(在这为`\rotatebox`)。门的名字可能会用美元符号围绕从而使之在数学模式下排版。

除了导线和量子门，`<q|pic>`还允许设置线路图表中其他几种常见元素。第六行的`=`命令接收一个可选参数并将其带着白色背景画在线路的中心。如果就像这个例子一样，没有给任何参数，那么就会画一个等于符号。

剩余的三行包含了额外的门：两个`CNOT`门和一个`Toffoli`门。可以使用`C`表示`CNOT`门而`T`表示`Toffoli`门；例如，第七行本可以写成`b C c`代表一个目标比特为`b`而控制比特为`c`的`CNOT`门。但是，由于这种门十分常见，`<q|pic>`将包含下列符号下面符号的指令当做这样的门：`+`用于说明$\oplus$算符将会作用在这根导线上，任何其他的导线都被当成是控制。注意控制信号可能出现在列表中的任何位置。如果没有列出任何目标，所有的导线都会被当成是控制，从而表明这是一个(受控)Z门。

###  2.2 例二：量子傅里叶变换

第二个例子是一个3比特的量子傅里叶变换线路，如[Figure-3](#qpic-3)所示。

<div align=center><img src="{{ site.baseurl }}/assets/images/2021/qpic-3.png" style="zoom:80%" id="qpic-3"></div>

`PREAMBLE`指令在TikZ环境前插入了$\LaTeX$代码；在这种情况下，我们定义了`\ket`和`\phase`命令，其会在线标签中使用(在这个例子中，`providecommand`对于这一构建很有用，因为它可以定义还没被定义的命令)。

`SCALE`命令缩放图片中的元素，这里放大到原本的1.5倍。注意文本并没有被放大。

在第4行至第6行声明了各导线，注意内部导线名与图表中所使用的描述并没有什么关联。

剩余的代码包含了两种类型的门：`H`(Hadamard门)和`P`(相位门)。`H`门是一个单量子门，只包含一个目标，而`P`门通常也是如此。对于Hadamard门，`H`完全说明了门的信息；而对于相位移动门(和第2.1节中的矩形相同)，我们必须在圆圈中写点什么。在这一例子中，相位门具有控制比特，而Hadamard门并不具有控制比特，但实际上，两个门都被运行拥有任意多的控制位。

这里值得注意一下Figure-3中量子门之间的空白部分。大部分门都是通过垂直的空白区域分隔开，但是第二个相位门与作用在$ \| x_1\rangle$​的Hadamard门之间的空间明显更少。

这是因为`<q|pic>`会检测两个量子门是否作用在不相交的量子比特集合上，并且是否可以被并行执行(如果我们改变导线的顺序，`<q|pic>`会将Hadamard门直接画在相位门的上面或者下面；而在Figure-3中，两者仅仅是相邻)。

`<q|pic>`使用简单的贪心逻辑去确定门的顺序：它将量子线路划分成一系列的时间片，或称为*切片(slices)*，并将门尽可能放到最早的切片中。这也是`<q|pic>`的特性之一；用户可以具体说明门列表的逻辑顺序而不需要考虑它们怎么在页面中出现。当然，如果有必要存在重写这一默认行为的方法，见第3.5节。

### 2.3 例三：Shor算法

<div align=center><img src="{{ site.baseurl }}/assets/images/2021/qpic-4.png" style="zoom:80%" id="qpic-3"></div>

Figure-4展示了`<q|pic>`的额外性质，以及一种不同的应用：算法的高级示意图。

第一行包含了`VERTICAL`指令；这告诉`<q|pic>`将线路垂直处理，时间从上往下流动。默认情况下，导线的顶端和底端标签会被水平打印；我们还可以声明一个角度(例如，`VERTICAL 45`)，其中`0`代表水平而`90`代表垂直。除此之外，代码顶部的新指令`DEPTAPAD 3`将时间片之间的空白设置成3个单位。

第6行和第7行像是标准的导线声明，除了第7行的`width=25`。这表明`<q|pic>`需要为页面上的导线预留更多的空白空间，以容纳需要更多空间的指数门。正如我们在第3.3节中讨论的那样，我们也可以使用`breadth=25`。注意`#`号在`<q|pic>`是评论符号，这一行中剩余的文字会被丢弃。

第9行用于在导线上画割线(一种表达一条导线表示多于1个量子比特的方法的常见方法)；导线的列表放在前面，尾部的可选参数在图表中在数学模式下被打印(出于`<q|pic>`的目的，这表达的是一个门，尽管它并不对应于任何计算)。这一行同时还包含了对宽度和高度的要求，这可以被作用于任何门以覆盖缺省值，通常用于容纳更多的文字。

接下来的若干行包含了`<q|pic>`的另一个功能：注释。在百分号`%`后的文本会被放到线路的左侧（对于水平的线路则是放到线路的上方）；如果有第二个百分号，其后面的文本会被放到线路的右侧（或下方）。正如我们在这个例子中所见到的，注释会被$\LaTeX$处理。较长的注释更适合使用竖直表现的线路。

除了注释，第10, 11和14行并没有新的内容：每个`G`门都具有一个控制和宽度参数。第12行引入了一个测量算子；它在每个指定的线上画了一个表状符号。可选地，如果在`M`后面跟着参数，那么表状符号会被一个内含指定文本的子弹形符号取代。

一条`<q|pic>`线可能具有下面三种类型之一：`qwire`（量子的，或者说是单线的)，`cwire`（经典的，或者说的双线的）以及`owire`（关闭状态）。由于测量操作会使一条线从量子状态转变成经典状态，`M`算子自动改变任何受到影响的线从`qwire`到`cwire`。在2.4节中我们可以直接改变线的类型（以及颜色和风格）。

正如在2.2节中提到的，`<q|pic>`会尽可能地将门放在同一片中——例如，第12行和第14行的操作可以画在一起。如果是这样，两者的注释会相互重叠，这样的展示效果显然是非常差的。解决方法在第13行，`x TOUCH`，这个操作实质上是一个空操作。它告诉`<q|pic>`此时去"干扰(touch)"线`x`（即在测量期间），迫使最终的门在下一个片中出现。如果`TOUCH`指令没有带任何参数，那么它会"干扰"所有线。

###  2.4 例四：传送

 <div align=center><img src="{{ site.baseurl }}/assets/images/2021/qpic-5.png" style="zoom:80%" id="qpic-3"></div>

在Figure-5中我们介绍了`<q|pic>`更多能实现的功能：颜色、通过添加冒号改变线的样式以及说明线的范围。

图片所示的程序中第一次使用`color=`的语法是在第5行我们声明线0时。它将线（初始的）颜色设置为红色。相似的，第13行也指定了一个红色的门。除此之外，还可以使用类似的语法`style=`将样式命令传递给TikZ，这可以改变线的厚度。

对于第17, 18行Bob的门，我们则是使用了定义在第三行的`Bob`宏来指定样式。粗略地说，`DEFINE`命令告诉

将剩余几行中所有下一个字符串(`Bob`)替换成指定字符串(`color=blue`)（注意这一展开只会影响`<q|pic>`指令，而不会去替换注释）。在底部的两个门中，虽然连接子的颜色为蓝色（即门的颜色）但是画出来确实双线（由于控制是经典的）。

第10行的语法使用了`:`的语法去改变两条线的颜色。这意味着对于这个门而言，`color=red`会被作用于线1，而`Bob`（即`color=blud`）会被作用到线2上。第17行和第18行使用了相似的语法将线的类型改变成`owire`，这意味着从这个点开始这些线都是处于一种"关闭"的状态（即不被画出）。

剩余的命令关于对每个切片的操作：第一个门集合被记作切片0(slice 0)，接着是切片1，以此类推。在第十一行中，`@ 2`指的是最近的两个切片（即0和1）。这个命令本身不完成任何操作，但使得我们可以对线路的一部分进行注释。在第16行和第19行中`@`符号后跟着的两个数字分别是开始的切片和结束的切片，两者共同组成一个切片的范围。注意`<q|pic>`完全可能在注释上覆盖注释，在选择注释的位置时应该更加谨慎。

`CUT`命令告诉`<q|pic>`在指定的切片前添加虚线("cut here" line)，在第12行，我们将一条线放于切片2之前。如果`CUT`后没有任何参数，`CUT`会在所有切片对之间添加虚线。



